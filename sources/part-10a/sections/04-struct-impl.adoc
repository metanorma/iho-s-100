[[cls-10a-4]]
== Structural Implementations

[[cls-10a-4.1]]
=== Introduction

This chapter specifies the structure of an exchange set at the record
and field levels. It further specifies the contents of the physical
constructs required for their implementation as <<ISO8211>> data
records, fields, and subfields. The grouping of records into
<<ISO8211>> files is considered application specific and is, therefore,
described in the relevant Product Specification. For the encoding only
the binary <<ISO8211>> format is used.

[[cls-10a-4.2]]
=== Notations used in this clause

The specification of the structure of a record is given as a tree
structure diagram which comprises the names, linkages and repetition
factors of the physical constructs. The detailed specifications of
fields and subfields are given in tabular form. Additionally for each
field the Data Descriptive field is given. Those fields are used in the
Data Descriptive Record (DDR) of an <<ISO8211>> conformal data set.

[[cls-10a-4.3]]
=== Tree structure diagrams

[[fig-10a-1]]
image::img130.png[]

[%key]
Where A is the root node and parent of node B and node C. Node B is the
root of a sub-tree and the parent of nodes D and E.

Nodes are also referred to as the offspring or child of their parents.
For example node B is the offspring of node A.

The tree structure diagrams must be interpreted in a pre-ordered
traversal sequence (top down, left branch first).

For ease of annotation these diagrams are presented vertically in this
standard using ASCII characters. In this notation the above diagram
becomes:

[source%unnumbered]
----
A
|
|-<r>--B (n): nameOfFieldB
|      |
|      *--D (n*m): nameOfFieldD
|      |
|      *--E (*n): nameOfFieldE
|
|-<r>--C (k\\*n): nameOfFieldC
----

Where:

A, B, C, ...:: <<ISO8211>> field tags

`<r>`:: `r` is the sub-tree cardinality (if missing, `r=1`) possible values:
::: `<0.. 1>` zero or one
::: `<0 .. *>` any number including zero
::: `<1.. *>` at least one

`(n)`:: the number of subfields is `n` (fixed number)

`(n*m)`:: subfields are stored as an `m` by `n` array with `m` rows and `n` columns (`n` subfields are repeated `m` times)

`(*n)`:: subfields are stored as a `n`-column table with an arbitrary number of rows (`n` subfields are repeating)

`(k\\*n)`:: A concatenation of `k` subfields and a `n`-column table (`k` subfields are followed by `n` repeating subfields)

The tree structure diagrams define which fields are allowed to be
repeated. However, within a record, the degree of repetition of fields
will depend on the data that is being encoded. In some cases a
particular field may not be required and so will be absent. However, in
all cases, the pre-order traversal sequence of a data record will be
the same as shown in the generic tree structure diagram for that record
type.

[[cls-10a-4.4]]
=== Field Tables

Each table is preceded by a row in bold outline indicating the field
name and field tag. The body of the table specifies the subfield names
and labels as well as the <<ISO8211>> format. The subfield
specification may include a required value or range constraint. The
following is an example of a field table using the Data Set
Identification field.

.Example of a field table
[cols=2]
|===
| Field Tag: *DSID* | Field Name: Data Set Identification
|===

[%unnumbered,cols=4,options=header]
|===
| Subfield name | Label | Format | Subfield content and specification

| Record name | RCNM | b11 | {10} -- Data Set Identification
| Record identification number | RCID | b14 | Range: 1 to 2^32^-2
| Encoding specification | ENSP | A() | Encoding specification that defines the encoding
| Encoding specification edition | ENED | A() | Edition of the encoding specification
| Product identifier | PRSP | A() | Unique identifier for the data product as specified in the Product Specification
| Product edition | PRED | A() | Edition of the Product Specification
| Application profile | PROF | A() | Identifier that specifies a profile within the data product
| Dataset file identifier | DSNM | A() | The file identifier of the dataset
| Dataset title | DSTL | A() | The title of the dataset
| Dataset reference date | DSRD | A(8) | The reference date of the datasetFormat: YYYMMDD according to <<ISO8601>>
| Dataset language | DSLG | A() | The (primary) language used in this dataset
| Dataset abstract | DSAB | A() | The abstract of the dataset
| Dataset edition | DSED | A() | The edition of the dataset
| Dataset topic category | *DSTC | b11 | A set of topic categories
|===

Where:

*Label*:: is the <<ISO8211>> subfield label, present only in the data
descriptive record and required to identify the subfields within a
field. A label preceded by "*" signifies that the subfield and the
subsequent ones, repeat within the field. This, therefore, indicates
the presence of a 2-D array or table for which the subfield labels
provide the column headings (the vector labels of a cartesian label).
*Format*:: is the <<ISO8211>> binary subfield data format.

[[cls-10a-4.5]]
=== Data formats

Subfield data formats are specified by <<ISO8211>>. The allowable data
formats are as follows:

.Subfield data formats
[cols="a,a,a,a",options=header]
|===
| Format | Data Type | Omitted values | Remark

| `A(n)`
| Character Data
| If the subfield has a fixed length the subfield will be filled with blanks (space character)

If the subfield length is variable only the unit terminator must be encoded
| `n` specified the length of the subfield (number of character)

`A()` indicates a sub field of variable length which must be terminated by the unit delimiter (UT). The encoding of Character Data within this standard must be UTF8 implementation level 1

The appropriate Escape Sequence is: (2/5) (2/15) (4/7) "%/G"

| `b1w`
| Unsigned Integer (LSBF){blank}footnote:[LSBF or "little-endian" is the byte order for multi-byte types. The least significant byte is placed closest to the beginning of a file.]
| The binary value with all bits set to 1 must be used
| `w` specifies the number of Bytes used

Permissible values are: 1,2,4

| `b2w`
| Signed Integer (LSBF)
| The binary value with all bits set to 1 must be used
| `w` specifies the number of Bytes used

Permissible values are: 1,2,4

| `b48`
| Signed Floating Point (LSBF)
| The value for 'Not A Number' (NaN) must be used
| according to IEC 559 or <<IEEE754>>
|===

[[cls-10a-4.6]]
=== Data Descriptive fields

Data Descriptive fields are fields of the Data Descriptive Record (DDR)
of an <<ISO8211>> conformal data file. These fields describe the format
of each field in a Data record (DR) of such a file. A Data Descriptive
field comprises the Field Control, the Data Field Name, the Array
Descriptor, and the Format Controls. More details on Data Descriptive
Fields are in <<ISO8211,clause="6.4">>.

Data Descriptive Fields contain non printable characters. In this
document they are replaced with graphical symbols as the following
table defines:

.Data Descriptive Fields
[cols="a,a,a",options=header]
|===
| Character | Code | Graphic

| Space | (2/0) | □
| UT (Unit Terminator) | (1/15) | ▲
| FT (Field Terminator) | (1/14) | ▼
|===

The Data Descriptive Field is given in a bold text box following the
table describing the format of the field.

[[cls-10a-4.7]]
=== Order of records

The order of records will enable the import software to check that a
referenced record exists each time it is referenced.

Exists means either:

* The record is inserted in this data set file prior to the record that
reference it; or
* It is inserted by the base data set file or an earlier update file
and not deleted between the insertion and the record that reference it.

In addition, when a record is going to be deleted it must not be
referenced by any other record.

The record order is:

. Data Set General Information record
. Data Set Coordinate Reference System record
. Information Type records (RUIN=Insert) (for the order inside this
group see the encoding rules for Information Type records)
. Point records (RUIN=Insert)
. Multi Point records (RUIN=Insert)
. Curve records (RUIN=Insert)
. Composite Curve records (RUIN=Insert) (for the order inside this
group see the encoding rules for Composite Curve records)
. Surface records (RUIN=Insert)
. Feature Type records (RUIN=Insert) (for the order inside this group
see the encoding rules for Feature Type records)
. Information Type records (RUIN=Modify)
. Point records (RUIN=Modify)
. Multi Point records (RUIN=Modify)
. Curve records (RUIN=Modify)
. Composite Curve records (RUIN=Modify)
. Surface records (RUIN=Modify)
. Feature Type records (RUIN=Modify)
. Feature Type records (RUIN=Delete) (reverse order as for Insert)
. Surface records (RUIN=Delete)
. Composite Curve records (RUIN=Delete) (reverse order as for Insert)
. Curve records (RUIN= Delete)
. Multi Point records (RUIN= Delete)
. Point records (RUIN= Delete)
. Information Type records (RUIN= Delete) (reverse order as for Insert)

Note that Product Specifications can omit entries they don't use but
not change the order. They might further define a more specific order
within each group if the general rule regarding references is not
broken.

If several records for the modification of one record are required in
one dataset, they must be using increasing record version numbers and
the order must be according to these numbers.

[[cls-10a-4.8]]
=== <<ISO8211>> file structure

[[cls-10a-4.8.1]]
==== General structure

This clause does not replace <<ISO8211>>, nor does it give a
comprehensive overview of <<ISO8211>>. The reader is referred to
<<ISO8211>> for a complete description and explanation.

The clause will give a short overview of <<ISO8211>> by explaining
those parts of the encapsulation structure which are of relevance to
S-100.

<<ISO8211>> files are organized by Logical Records (LR), the first
record is the Data Descriptive Record (DDR) and all subsequent records
are Data Records (DR).

The DDR contains information on the hierarchy and structure of the
remaining part of the file. It does not define the semantic of the data.

Each Logical Record (both DDR and DR) contains three basic elements:

* Leader
* Directory
* Field Area

[[cls-10a-4.8.2]]
==== The Leader

The Leader of a Logical Record contains the parameters necessary to
read records and to disaggregate the directory into its entries. In
addition, the DDR Leader contains a few data descriptive parameters
applicable to the entire file. It has a fixed length of 24 bytes.

The first five bytes in any Leader will contain the length of the
complete Record in bytes encoded as a decimal number in ASCII
representation (for example, a Record of 242 bytes will have a record
length entry of "00242"). If a Record has a size of 100000 bytes or
larger then the value must be set to "00000". In this case the software
must be able to calculate the Record size from the information in the
directory.

[[cls-10a-4.8.2.1]]
===== The DDR Leader

The structure of the DDR Leader:

.Structure of the DDR Leader
[cols="a,a,a,a",options=header]
|===
| RP | Len | Entry name | Content

| 0 | 5 | Record length | Number of bytes in the Record
| 5 | 1 | Interchange level | "3"
| 6 | 1 | Leader identifier | "L"
| 7 | 1 | In line code extension indicator | "E"
| 8 | 1 | Version number | "1"
| 9 | 1 | Application indicator | SPACE
| 10 | 2 | Field control length | "09"
| 12 | 5 | Base address of Field Area | Start address of Field Area (number of bytes in the Leader and Directory)
| 17 | 3 | Extended character set indicator | " ! " (SPACE,!,SPACE)
| 20 | 4 | Entry map | (See below)
|===

The entry map of the DDR Leader:

.Entry map of the DDR Leader
[cols="a,a,a,a",options=header]
|===
| RP | Sub-entry name | Length | Content

| 20 | Size of field length field | 1 | Variable "1"-"9" (defined by encoder)
| 21 | Size of field position field | 1 | Variable "1"-"9" (defined by encoder)
| 22 | Reserved | 1 | "0"
| 23 | Size of field tag field | 1 | "4"
|===

[[cls-10a-4.8.2.2]]
===== The DR Leader

The structure of the DR Leader:

.Structure of the DR Leader
[cols="a,a,a,a",options=header]
|===
| RP | Len | Entry name | Content
| 0 | 5 | Record length | number of bytes in the Record
| 5 | 1 | Interchange level | SPACE
| 6 | 1 | Leader identifier | "D"
| 7 | 1 | In line code extension indicator | SPACE
| 8 | 1 | Version number | SPACE
| 9 | 1 | Application indicator | SPACE
| 10 | 2 | Field control length | 2 SPACEs
| 12 | 5 | Base address of Field Area | Start address of Field Area (number of bytes in the Leader and Directory)
| 17 | 3 | Extended character set indicator | 3 SPACEs
| 20 | 4 | Entry map | (See below)
|===

The entry map of the DR Leader:

.Entry map of the DR Leader
[cols="a,a,a,a",options=header]
|===
| RP | Sub-entry name | Length | Content

| 20 | Size of field length field | 1 | Variable "1"-"9" (defined by the encoder)
| 21 | Size of field position field | 1 | Variable "1"-"9" (defined by the encoder)
| 22 | Reserved | 1 | "0"
| 23 | Size of field tag field | 1 | "4"
|===

[[cls-10a-4.8.3]]
==== The Directory

The Directory of a Logical Record contains the parameters necessary to
identify and locate each field in the Field Area. The Directory
consists of repeated Directory entries containing the:

* field tag;
* field length; and
* field position.

The Directory ends with the field terminator (1/14). The field
positions are relative to the beginning of the Field Area. The position
of the first field following the Directory is 0. The number of bytes
used for the three elements (the field entry) is defined by the entry
map in the Leader of the Logical Record.

[[cls-10a-4.8.4]]
==== The Field Area

The Field Area is different for the DDR and DR. In the first Record
only, the DDR, the Field Area contains data descriptive fields. Each
data descriptive field contains information necessary to decode the
user data in the Field Area of the DR('s). The fact that the data
description is contained in the interchange file makes it possible to
exchange data without an external description, though the semantic of
the elements is not known. The S-100 Standard and the Product
Specifications that use an <<ISO8211>> data encoding does contain an
external data description used for the exchange of the data. However,
the data descriptive fields can only be omitted from the DDR if they
are not used in the current file; not because of the existence of an
external data description. The data descriptive fields of the DDR form
an integral part of an <<ISO8211>> conforming file.

The limitation to the used fields is a minimum requirement and other
fields may be defined by data descriptive fields in the DDR. However,
this adds unnecessary data to the data set and should be avoided.

The Field Area of the DR contains the actual data to be transferred.

[[cls-10a-4.8.4.1]]
===== The Field Area of the DDR

====== Field control field

The first field of the DDR is the field control field. The field tag
for the field control field is "0000". The field control field contains
a list of field tag pairs. The list defines the hierarchy of all the
fields described in the DDR. The list contains pairs of partent/child
tags and together with the preorder traversal sequence of the field
descriptions in the DDR describes a generic tree structure for the
exchange file. The pairs may be placed in the list in any sequence and
must be contiguous. <<fig-10a-2>> gives an example of a tree.
The set of field tag pairs is HE, EA, EB, HF, HG, GC and GD.

[[fig-10a-2]]
image::img131.png[]

The structure of the field control field is as follows:

.Structure of the field control field
|===
| Field controls | External file title (Optional for S-100) | UT | List of field tag pairs | FT
|===

The field controls of the field control field are : "0000;&" + 3 SPACEs.

====== Data descriptive fields

The successive fields of the field area contain the data descriptive
fields. The data descriptive fields are encoded in the DDR in a
preorder traversal sequence. The preorder traversal sequence of the
tree shown above is HEABFGCD.

The structure of a data descriptive field is as follows:

.Structure of the data descriptive field
|===
| Field controls | Field name | UT | Array descriptor | UT | Format controls | FT
|===

The field controls describe the level and data type of the data fields
defined by the data descriptive fields. The structure of the field
controls is shown in the following Table.

.Structure of the field controls
[cols="a,a,a,a",options=header]
|===
| RP | Len | Entry name | Content

| 0 | 1 | Data structure code | "1" -- linear structure

"2" -- multi-dimensional structure

"3" -- concatenated structure
| 1 | 1 | Data type code | "1" -- implicit point (integer)

"2" -- implicit point (float)

"6" -- mixed data types
| 2 | 2 | Auxiliary controls | "00"
| 4 | 2 | Printable graphics | ";&"
| 6 | 3 | Truncated escape sequence | " " (3 SPACEs) -- ASCII Encoding <<ISO646>>

"%/G" -- UTF8 Encoding implementation level 1
|===

The field name contains the long description of the data fields as
defined in the tree structures given in this Part of S-100. The Array
descriptor and Format controls define the inner field structure for the
associated data fields. Refer to <<ISO8211>> for a complete description.

[[cls-10a-4.8.4.2]]
===== The Field Area of the DR's

The data fields in the DR's must be encoded in the preorder traversal
sequence as defined in the DDR. The structure of the data fields is
defined by the data descriptive fields in the DDR.

[[cls-10a-4.8.5]]
==== An example

The following rather simple example shows an S-100 conformal
<<ISO8211>> conformal dataset file.

It contains a single feature type (_BuoySafeWater_) with the following
attribute set:

.Example of an conformal dataset file
[cols="a,a,a",options=header]
|===
| Attribute Code | Value | Remarks

| buoyShape | "4" | Pillar
| colour[1] | "3" | Red
| colour[2] | "1" | White
| colourPattern | "3" | Diagonal Stripes
| featureName[1].language | "eng" | English
| featureName[1].name
| "Example buoy"
|

| featureName[2].language | "deu" | German
| featureName[2].name
| "Beispiel Tonne"
|
|===

The Feature Object Id is:

.Feature Object Id
[cols="a,a,a",options=header]
|===
| Sub-Field | Integer value | Hexadecimal representation

| Producing agency | 31868 | 7C7C
| Feature identification number | 12345678 | 00BC614E
| Feature identification subdivision | 42 | 002A
|===

The position is:

.Position
[cols="a,a,a,a",options=header]
|===
|
| Geo position
| Integer value
| Hexadecimal representation

| Latitude | stem:[42,42 "unitsml(deg)" "N"] | 424200000 | 1948C740
| Longitude | stem:[12,1234 "unitsml(deg)" "W"] | -121234000 | F8C61DB0
|===

The example contains non-printable characters and binary codes. They
are replaced with the denotation as defined in the following Table:

.Denotations for non-printable characters and binary codes
[cols="a,a,a,a",options=header]
|===
| Character | Code | Denotation | Remarks

| Space
| Hex 20
| □
|

| UT (Unit Terminator)
| Hex 1F
| ▲
|

| FT (Field Terminator)
| Hex 1E
| ▼
|

| Binary code b11
| Hex xx
| [xx]
|

| Binary code b12 | Hex xxyy | [xxyy] | Due to the LSBF encoding this is equivalent to [yy][xx]
| Binary code b14 | Hex wwxxyyzz | [wwxxyyzz] | Due to the LSBF encoding this is equivalent to [zz][yy][xx][ww]
| Binary code b24 | Hex wwxxyyzz | [wwxxyyzz] | For negative numbers the two complement is encoded LSBF
| Binary code b48 | x.y | [x.y] | Encoded as defined by the IEEE 754 double precision encoding LSBF
|===

.DDR Leader
[source%unnumbered]
----
011803LE1□0900155□!□3304
----

.DDR Directory
[source%unnumbered]
----
0000090000DSID132090DSSI118222ATCS044340FTCS047384CSID084431CRSH095515PRID071610C2IT055681FRID084736FOID064820ATTR058884SPAS083942▼
----

.DDR Field Area
[source%unnumbered]
----
0000;&□□□S100Example.000▲DSIDDSSIDSIDATCSDSIDFTCSCSIDCRSHPRIDC2ITFRIDFOIDFRIDATTRFRIDSPAS▼

3600;&%/GData□Set□Identification▲RCNM!RCID!ENSP!ENED!PRSP!PRED!PROF!DSNM!DSTL!DSRD!DSLG!DSAB!DSED\\*DSTC▲(b11,b14,7A,A(8),3A,(b11))▼

1600;&□□□Data□Set□Structure□Information▲DCOX!DCOY!DCOZ!CMFX!CMFY!CMFZ!NOIR!NOPN!NOMN!NOCN!NOXN!NOSN!NOFR▲(3b48,10b14)▼

2600;&□□□Attribute□Codes▲*ATCD!ANCD▲(A,b12)▼

2600;&□□□Feature□Type□Codes▲*FTCD!FTNC▲(A,b12)▼

1100;&□□□Coordinate□Reference□System□Record□Identifier▲RCNM!RCID!NCRC▲(b11,b14,b11)▼

1600;&%/GCoordinate□Reference□System□Header▲CRIX!CRST!CSTY!CRNM!CRSI!CRSS!SCRI▲(3b11,2A,b11,A)▼

1100;&□□□Point□Record□Identifier▲RCNM!RCID!RVER!RUIN▲(b11,b14,b12,b11)▼

1100;&□□□2-D□Integer□Coordinate□Tuple▲YCOO!XCOO▲(2b24)▼

1100;&□□□Feature□Type□Record□Identifier▲RCNM!RCID!NFTC!RVER!RUIN▲(b11,b14,2b12,b11)▼

1100;&□□□Feature□Object□Identifier▲AGEN!FIDN!FIDS▲(b12,b14,b12)▼

2600;&%/GAttribute▲*NATC!ATIX!PAIX!ATIN!ATVL▲(3b12,b11,A)▼

2100;&□□□Spatial□Association▲*RRNM!RRID!ORNT!SMIN!SMAX!SAUI▲(b11,b14,b11,2b14,b11)▼
----

.DR 1 Leader (Data Set General Information record)
[source%unnumbered]
----
00321□D□□□□□00065□□□3304
----

.DR 1 Directory
[source%unnumbered]
----
DSID104000DSSI065104ATCS070169FTCS017239▼
----

.DR 1 Field Area
[source%unnumbered]
----
[0A][00000001]S-100□Part□10a▲5.0▲INT.IHO.S-101.1.1▲1.1▲1▲S100Example.000▲S-100□Encoding□example▲20221019EN▲▲1▲[0E][12]▼

[0.0][0.0][0.0][00989680][00989680][00000064][00000000][00000001][00000000][00000000][00000000][00000000][00000001]▼

buoyShape▲[0001]colour▲[0002]colourPattern▲[0003]featureName▲[0004]language▲[0005]name▲[0006]▼

BuoySafeWater▲[0001]▼
----

.DR 2 Leader (Data Set Coordinate Reference System record)
[source%unnumbered]
----
00064□D□□□□□00039□□□2104
----

.DR 2 Directory
[source%unnumbered]
----
CSID070CRSH187▼
----

.DR 2 Field Area
[source%unnumbered]
----
[0F][00000001][01]▼

[01][01][01]WGS□84▲4326▲[02]▲▼
----

.DR 3 Leader (Point Record)
[source%unnumbered]
----
00055□D□□□□□00037□□□1104
----

.DR 3 Directory
[source%unnumbered]
----
PRID90C2IT99▼
----

.DR 3 Field Area
[source%unnumbered]
----
[6E][00000001][0001][01]▼

[1948C740][F8C61DB0]▼
----

.DR 4 Leader (Feature Type Record)
[source%unnumbered]
----
00218□D□□□□□00065□□□3304
----

.DR 4 Directory
[source%unnumbered]
----
FRID011000FOID009011ATTR117020SPAS016137▼
----

.DR 4 Field Area
[source%unnumbered]
----
[64][00000001][0001][0001][01]▼

[7C7C][00BC614E][002A]▼

[0001][0001][0000][01]4▲
[0002][0001][0000][01]3▲
[0002][0002][0000][01]1▲
[0003][0001][0000][01]3▲
[0004][0001][0000][01]▲
[0005][0001][0005][01]eng▲
[0006][0001][0005][01]Example□buoy▲
[0004][0002][0000][01]▲
[0005][0001][0008][01]deu▲
[0006][0001][0008][01]Beispiel□Tonne▲▼

[6E][00000001][FF][FFFFFFFF][00000000][01]▼
----
