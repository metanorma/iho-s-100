[[cls-10a-5]]
== Common Fields

[[cls-10a-5.1]]
=== Attribute field

[[cls-10a-5.1.1]]
==== Encoding rules

In S-100 attributes can be either simple or complex. Simple attributes
have values whereas complex attributes are an aggregation of other
attributes, either simple or complex. The following diagram shows an
example of a feature type with both simple and complex attributes.

[[fig-10a-3]]
image::img132.png[]

The feature has four attributes: A1, A2, A3, and A4. A1 and A3 are
simple attributes; A2 and A4 are complex attributes. A2 comprises two
attributes (A5 and A6) where A5 is a simple one and A6 is another
complex attribute. A4 and A6 are two complex attributes; both consist
of two simple attributes.

Another characteristic of attributes is the cardinality. This indicates
how many attributes of the same kind (the same code in a feature
catalogue) are used at the same parent. The same parent means that they
are all top level attributes or belonging to the same instance of a
complex attribute. In the example above A9 and A10 are assumed to have
the same code.

With the concept of cardinalities larger than one, an attribute can be
seen as an array of attributes. To access an attribute in such an array
one needs not only the code of that attribute but also the index of
that attribute. Note that the order in such an array may be meaningful
and must be maintained by the encoding.

Taking all of the above into account an attribute can be uniquely
addressed by three values:

. The attribute code -- encoded with the sub-field NATC;
. The index of the attribute (starting with 1) -- encoded with the
sub-field ATIX;
. The parent of the attribute -- encoded with the sub-field PAIX.

The Parent Index (PAIX) is solely used for defining the tree inside the
field only, and there is no need to preserve it in an internal system
(for example, System Database) structure.

To complete the example above, the following table defines codes and
values of the attributes:

.Codes and values of the attributes
[cols="a,a,a,a,a",options=header]
|===
| Attribute | Code | Attribute Index | Value | Remarks

| A1
| 21
| 1
| Vachon
|

| A2
| 22
| 1
|
| complex

| A3
| 23
| 1
| 12
|

| A4
| 24
| 1
|
| complex

| A5
| 25
| 1
| 42.0
|

| A6
| 26
| 1
|
| complex

| A7
| 27
| 1
| 123
|

| A8
| 28
| 1
| Canada
|

| A9 | 29 | 1 | 17 | same code as A10
| A10 | 29 | 2 | 43 | same code as A9
|===

To encode an attribute a set of five items is necessary: the three
mentioned above plus an update instruction and the value of the
attribute. To specify the parent of the attribute an index is used.
This index points to the n^th^ tuple in the ATTR field starting with 1.
The following table shows the encoding of the example:

.Encoding of the example
[cols=7,options=header]
|===
| Index | NATC | ATIX | PAIX | ATIN | ATVL | Remark

| 1 | 21 | 1 | 0 | Insert | Vachon | A1
| 2 | 22 | 1 | 0 | Insert | | A2 - complex
| 3 | 25 | 1 | 2 | Insert | 42.0 | A5
| 4 | 26 | 1 | 2 | Insert | | A6 - complex
| 5 | 29 | 1 | 4 | Insert | 17 | A9
| 6 | 29 | 2 | 4 | Insert | 43 | A10
| 7 | 23 | 1 | 0 | Insert | 12 | A3
| 8 | 24 | 1 | 0 | Insert | | A4 - complex
| 9 | 27 | 1 | 8 | Insert | 123 | A7
| 10 | 28 | 1 | 8 | Insert | Canada | A8
|===

Note that here the pre-order traversing is used to define the order of
tuples in the field. This keeps all part of a complex attribute
together and guarantees that the parent is always stored before the
child. The pre-order traversing is defined as follows:

. Encode the root;
. Then encode the sub-trees from left to right.

This traversing order is mandatory within this standard.

Note also that the ATIN subfield (Attribute update Instruction) will
always be 'Insert' for encoding base data attributes. The other ATIN
values (Modify, Delete) are only needed for updating the ATTR field.

All values of attribute are stored as character strings even if the
value domain is a numeric type. UTF-8 will be the only encoding allowed
in S-100 for such character strings. This allows the encoding of all
characters of the first multilingual plane of <<ISO10646>>. There is no
other encoding for national character sets necessary.

[[cls-10a-5.1.2]]
==== Updating of the Attribute field

To update an attribute the attribute must be uniquely identifiable and
once identified instructions are needed to affect that attribute.

The identifiaction of an attribute is defined by the Numeric Attribute
Code (NATC) and the Attribute Index (ATIX).

The Attribute Update Instruction indicates whether an attribute is to
be deleted from the field; modified, or inserted. Deletion and
modification imply that the attribute exists. Deletion and insertion
may change the indices of other attributes in an array of attributes
and therefore must be taken into account when the attribute field is
updated, thus the ATIX sub-field must use then the corrected value.
Instructions must be applied in sequence in order that the indices used
are identifying the correct attributes components on subsequent updates.

To demonstrate the updating of attributes the example above should be
modified as shown in the following <<fig-10a-4>>. Note that to identify
a node in the attribute tree it is necessary to specify all nodes from
the root of the tree. In order to insert the attribute B5 both the
nodes A6 and A2 must be encoded before and marked as modified.

[[fig-10a-4]]
image::img133.png[]

The details are:

.Attribute tree update with node insertion and modification
[cols=6,options=header]
|===
| Attribute | Code | Attribute Index | Value | Update Instruction | Remarks

| B5 | 29 | 2 | 32 | Insert | Will change A10's index to 3
| A10 | 29 | 3 | 7 | Modify |
| B2 | 35 | 1 | | Insert | complex
| B3 | 36 | 1 | 32 | Insert |
| B4 | 37 | 1 | 123 | Insert |
| B1 | 32 | 1 | abc | Insert |
| A3 | 23 | 1 | 12 | Delete |
| A8 | 28 | 1 | Germany | Modify |
|===

In order to identify B5, A10 and B2 the entries for A2 and A6 must be
inserted. The same is true for A4 (to identify A8). The complete field
will look like:

.Insertion of entries to identify attributes in the field
[cols=7,options=header]
|===
| Index | NATC | ATIX | PAIX | ATIN | ATVL | Remark

| 1 | 22 | 1 | 0 | Modify | | A2 - complex
| 2 | 26 | 1 | 1 | Modify | | A6 - complex
| 3 | 29 | 2 | 2 | Insert | 32 | B5 - Will increase the ATIX of A10
| 4 | 29 | 3 | 2 | Modify | 7 | A10 - now with ATIX 3
| 5 | 35 | 1 | 2 | Insert | | B2 - complex
| 6 | 36 | 1 | 5 | Insert | 22 | B3
| 7 | 37 | 1 | 5 | Insert | 123 | B4
| 8 | 32 | 1 | 0 | Insert | abc | B1
| 9 | 23 | 1 | 0 | Delete | | A3
| 10 | 24 | 1 | 0 | Modify | | A4 - complex
| 11 | 28 | 1 | 10 | Modify | Germany | A8
|===

Note that in order to delete a complex attribute it will be adequate to
delete the root entry of that attribute. For example, to delete A2 only
one entry (22, 1, 0, Delete) has to be encoded.

[[cls-10a-5.1.3]]
==== Unknown attribute values

An attribute value is unknown whenever the attribute code is present,
but the attribute value is missing (encoded as an empty string).

Updating of the attribute field with a missing attribute value:

* Insert - create the attribute with an initial value of unknown.
* Modify - change the attribute value to unknown.
* Delete - delete the attribute (in this case the attribute value
should always be encoded as 'unknown').

[[cls-10a-5.1.4]]
==== Encoding of attribute values

The following rules must be used to encode attribute values in the
ATVL sub-field:

.Encoding rules for attribute values in the ATVL sub-field
[cols="a,a,a,a",options=header]
|===
| Attribute Type [Value Type] | Format | Remarks | Examples

| *S100_GF_TextAttributeType* [CharacterString]
| Any characters that are supported by the encoding (here - UTF8).
| Byte order marks are not permitted since the encoding does not require them (UTF8 is not a multi byte encoding).
| whiskey

водка

.2+| *S100_GF_IntegerAttribute* [Integer]
.2+| Signed Integer numbers of arbitrary length. The numbers must be in the decimal system.
.2+| Positive numbers should not use the '+' sign.

Negative numbers must have a leading '-' sign.

There must be no whitespaces between the sign and the number.

There must be no characters other than the digits '0' to '9' in the number.

Non-significant zeros are prohibited.
| [underline]#Valid#:

42

-1224566
| [underline]#Not Valid#:

0012

123,234

-12

| *S100_GF_RealAttribute* [Real]
| Decimal floating-point numbers in the value domain of double precision numbers (IEEE 64-Bits).
| The decimal separator is always a point ('.') and there must be no thousands separator used.

Positive numbers should not use the '+' sign.

Negative numbers must have a leading '-' sign.

The exponential form is permitted.

Non-significant zeros are prohibited. If there are only zeros to the right of the decimal point the decimal point should be omitted.

The values INF, -INF, and NaN are prohibited.
| 123.456

-42

1E-5

-2.45E7

| *S100_BooleanAttributeType* [Boolean]
| 1 (true) or

0 (false)
|
| 1

0

| *S100_EnumerationAttributeType* [Positive Integer]
| Integer numbers > 0 in the decimal system.
| Non-significant zeros are prohibited. The '+' sign should not be used.
|

| *S100_DateAttributeType* [Date]
| CCYYMMDD

Complete representation, basic format according to <<ISO8601>>.
| Representation with reduced resolution or truncated representations are prohibited.
| 20211223

| *S100_TimeAttributeType* [Time]
| HHmmss

Complete representation, basic format according to <<ISO8601>>.
| Optionally a time zone can be added.Fractions of a second are permitted but should be omitted if all zero.
| 173500

183942+Z

201700-0500

| *S100_DateTimeAttributeType* [DateTime]
| Combination of date and time representation as above.
| The character 'T' must be used as the separator between the date and the time part.
| 20211223T170000

| *S100_URIAttributeType* [URI]
| A URI according to the <<RFC3986>>.
| URI must not contain white spaces; and must start with a 'scheme' followed by a ':'.
| tel:+1-816-555-1212[]

| *S100_URLAttributeType* [URL]
| A URL according to the <<RFC3986>>.
|
| http://registry.iho.int/[http://registry.iho.int]

| *S100_URN_AttributeType* [URN]
| A URN as specified in <<RFC2141>>
| 'scheme' = urn
| urn:mrn:iala:aton:us:1234.5

| *S100_TruncatedDateAttributeType* [S100_TruncatedDate]
| A truncated version of a date.
| CCYYMMDD

All unspecified components are replaced by as many hyphens as the component has characters. Hence, the length of the encoding must be always 8 characters.
| ------01

----1224

| *S100_CodelListAttributeType* [CharacterString]
| A code list value, represented as a CharacterString.
| The URI of the code list dictionary is defined by the Feature Catalogue.

See <<Part3;and!Part5>> for more details.
| eng
|===

[yaml2text,sections/tables/05-tables.yaml,data]
----
{% assign start_index = 5 %}
{% for item in data offset:0 limit:1 %}
[[cls-10a-5.1.{{start_index | plus: forloop.index}}]]
==== {{item.table-name}}

.{{item.table-name}}
[cols=2,options=header]
|===
| Field Tag | Field Name
| *{{item.field-tag}}* | {{item.field-name}}
|===

[%unnumbered,cols="a,a,a,a",options=header]
|===
| Subfield Name | Label | Format | Content

{% for row in item.subfields %}
| {{row.subfield-name}} | {{row.label}} | {{row.format}} | {{row.subfield-content}}
{% endfor %}
|===

{% if item.ddf and item.ddf != "" %}
.Data Descriptive Field
[source%unnumbered]
--
{{item.ddf}}
--
{% endif %}

{% endfor %}
----

[[cls-10a-5.2]]
=== Information Association field

[[cls-10a-5.2.1]]
==== Encoding rules

An Information association is a link from one record to an information
type record. An information type record can be referenced from any
number of other records but at least one record should have an
association to an information type record. Such associations will be
encoded by means of the Information Association field (INAS). For each
association a separate field has to be used. The association itself can have attributes. The attributes are encoded in the field by the
same mechanism as described for the ATTR field. The same subfields are
used at the end of the association field. Each association is uniquely
addressed by the combination of the RRNM, RRID, IASS, and ROLE
subfields.

The RRNM subfield is referencing the record name subfield (RCNM) and
the RRID subfield is referencing the record id subfield (RCID) of the
target record.

The Information Association Update Instruction INUI subfield is used
to indicate if an association is to be inserted or deleted on update.
For a base data set this field must have the value 'Insert'.

[yaml2text,sections/tables/05-tables.yaml,data]
----
{% assign start_index = 2 %}
{% for item in data offset:1 limit:1 %}
[[cls-10a-5.2.{{start_index | plus: forloop.index}}]]
==== {{item.table-name}}

.{{item.table-name}}
[cols=2,options=header]
|===
| Field Tag | Field Name
| *{{item.field-tag}}* | {{item.field-name}}
|===

[%unnumbered,cols="a,a,a,a",options=header]
|===
| Subfield Name | Label | Format | Content

{% for row in item.subfields %}
| {{row.subfield-name}} | {{row.label}} | {{row.format}} | {{row.subfield-content}}
{% endfor %}
|===

{% if item.ddf and item.ddf != "" %}
.Data Descriptive Field
[source%unnumbered]
--
{{item.ddf}}
--
{% endif %}

{% if item.note and item.note != "" %}
NOTE: {{item.note}}
{% endif %}

{% endfor %}
----
